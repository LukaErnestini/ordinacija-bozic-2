import type { Metadata } from "next";
import { Montserrat, Playfair_Display } from "next/font/google";
import "./globals.css";
import Navbar from "@/components/navbar";
import Footer from "@/components/footer";
import client from "@/tina/__generated__/client";

const montserrat = Montserrat({
  subsets: ["latin"],
  variable: "--font-montserrat",
  display: "swap"
});

const playfairDisplay = Playfair_Display({
  subsets: ["latin"],
  variable: "--font-playfair-display",
  display: "swap"
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app"
};

export default async function RootLayout({
  children
}: Readonly<{
  children: React.ReactNode;
}>) {
  const locationsResponse = await client.queries.locationConnection();
  const servicesResponse = await client.queries.servicesConnection();

  // Transform services data into navigation structure
  const serviceItems =
    servicesResponse.data?.servicesConnection.edges?.map((edge) => ({
      name: edge?.node?.title || "",
      href: `/storitve/${edge?.node?._sys.filename}`
    })) || [];

  const navigationItems = [
    {
      name: "Predstavitev",
      href: "/predstavitev"
    },
    {
      name: "Storitve",
      href: "/storitve",
      subItems: serviceItems
    },
    {
      name: "Delovni cas",
      href: "/delovni-cas"
    },
    {
      name: "Kje smo",
      href: "/kje-smo"
    },
    {
      name: "Obvestila",
      subItems: [
        { name: "O nas", href: "/o-nas" },
        { name: "Cenik", href: "/cenik" },
        { name: "Pogosta vpraÅ¡anja", href: "/faq" }
      ]
    },
    {
      name: "Kontakt",
      href: "/kontakt"
    }
  ];

  const locations =
    locationsResponse.data.locationConnection.edges?.map((edge) => {
      const node = edge?.node;
      return {
        officeHours: node?.officeHours || null,
        phone: node?.phone?.filter((p): p is string => p !== null) || [],
        googleMapsEmbedSrc: node?.googleMapsEmbedSrc || "",
        name: node?.label || "",
        email: node?.mail || ""
      };
    }) || [];

  return (
    <>
      <html
        data-theme="mytheme"
        lang="en"
        className={`${montserrat.variable} ${playfairDisplay.variable} antialiased`}
      >
        <body className="font-montserrat min-h-dvh flex flex-col">
          <Navbar items={navigationItems}></Navbar>
          <div className="grow mt-20">{children}</div>
          {/* <pre>{JSON.stringify(serviceItems, null, 2)}</pre> */}
          <Footer locations={locations} />
        </body>
      </html>
    </>
  );
}
